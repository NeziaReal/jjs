print("Lock-On Fixed: No more leaving the body.")

local NotificationLibrary = loadstring(game:HttpGet("https://raw.githubusercontent.com/IceMinisterq/Notification-Library/Main/Library.lua"))()

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")

local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local LockonEnabled = false
local LockedTarget = nil
local TargetGui = nil

local Smoothness = 0.2 

local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local ToggleBtn = Instance.new("TextButton")
local LockBtn = Instance.new("TextButton")

ScreenGui.Name = "FixedMobileLock"
ScreenGui.Parent = (gethui and gethui()) or CoreGui
ScreenGui.ResetOnSpawn = false

MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MainFrame.BackgroundTransparency = 0.4
MainFrame.Position = UDim2.new(0.1, 0, 0.5, 0)
MainFrame.Size = UDim2.new(0, 80, 0, 90)
MainFrame.Active = true
MainFrame.Draggable = true

local UICorner = Instance.new("UICorner", MainFrame)
local UIList = Instance.new("UIListLayout", MainFrame)
UIList.HorizontalAlignment = Enum.HorizontalAlignment.Center
UIList.Padding = UDim.new(0, 5)

ToggleBtn.Name = "ToggleBtn"
ToggleBtn.Parent = MainFrame
ToggleBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
ToggleBtn.Size = UDim2.new(0.9, 0, 0, 40)
ToggleBtn.Text = "OFF"
ToggleBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", ToggleBtn)

LockBtn.Name = "LockBtn"
LockBtn.Parent = MainFrame
LockBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
LockBtn.Size = UDim2.new(0.9, 0, 0, 40)
LockBtn.Text = "LOCK"
LockBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", LockBtn)

local function createTargetGui(character)
    if TargetGui then TargetGui:Destroy() end
    local root = character:FindFirstChild("HumanoidRootPart")
    if not root then return end
    local billboard = Instance.new("BillboardGui", root)
    billboard.Name = "TargetOverlay"
    billboard.Size = UDim2.new(0, 100, 0, 100) 
    billboard.AlwaysOnTop = true
    local image = Instance.new("ImageLabel", billboard)
    image.Size = UDim2.new(1, 0, 1, 0)
    image.BackgroundTransparency = 1
    image.Image = "rbxassetid://263401222"
    image.ImageColor3 = Color3.fromRGB(255, 0, 0)
    TargetGui = billboard
end

local function getClosestPlayer()
    local closestPlayer = nil
    local shortestDistance = math.huge
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
            local pos, onScreen = Camera:WorldToViewportPoint(player.Character.Head.Position)
            if onScreen then
                local dist = (Vector2.new(pos.X, pos.Y) - Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)).Magnitude
                if dist < shortestDistance then
                    shortestDistance = dist
                    closestPlayer = player
                end
            end
        end
    end
    return closestPlayer
end

RunService.RenderStepped:Connect(function()
    if LockonEnabled and LockedTarget and LockedTarget.Character then
        local targetHead = LockedTarget.Character:FindFirstChild("Head")
        local myChar = LocalPlayer.Character

        if targetHead and myChar then

            local lookAtCFrame = CFrame.new(Camera.CFrame.Position, targetHead.Position)

            Camera.CFrame = Camera.CFrame:Lerp(lookAtCFrame, Smoothness)
        end
    end
end)

ToggleBtn.MouseButton1Click:Connect(function()
    LockonEnabled = not LockonEnabled
    ToggleBtn.Text = LockonEnabled and "ON" or "OFF"
    ToggleBtn.BackgroundColor3 = LockonEnabled and Color3.fromRGB(50, 200, 50) or Color3.fromRGB(200, 50, 50)
    if not LockonEnabled then 
        LockedTarget = nil 
        if TargetGui then TargetGui:Destroy() end
    end
end)

LockBtn.MouseButton1Click:Connect(function()
    if not LockonEnabled then return end
    if LockedTarget then
        LockedTarget = nil
        if TargetGui then TargetGui:Destroy() end
    else
        local t = getClosestPlayer()
        if t then
            LockedTarget = t
            createTargetGui(t.Character)
        end
    end
end)
